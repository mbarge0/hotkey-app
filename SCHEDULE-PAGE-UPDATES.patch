// Add to state declarations (after line 10):
const [unscheduledFilter, setUnscheduledFilter] = useState<Platform | 'all'>('all')
const [postStatus, setPostStatus] = useState<Record<string, { status: string, timestamp: string }>>({})

// Add loadPostStatus function (after loadQueue):
async function loadPostStatus() {
  try {
    const res = await fetch('/review/post-status.json')
    if (res.ok) {
      const data = await res.json()
      setPostStatus(data.posts || {})
      
      // Apply loaded status to unscheduled posts
      setUnscheduledPosts(prev => prev.map(p => ({
        ...p,
        status: (data.posts[p.id]?.status as any) || p.status
      })))
    }
  } catch (err) {
    console.log('No post status file yet')
  }
}

// Add savePostStatus function:
async function savePostStatus(postId: string, status: string) {
  const updated = {
    ...postStatus,
    [postId]: {
      status,
      timestamp: new Date().toISOString()
    }
  }
  
  setPostStatus(updated)
  
  // Save to file
  try {
    await fetch('/review/post-status.json', {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        posts: updated,
        lastUpdated: new Date().toISOString()
      })
    })
  } catch (err) {
    console.error('Failed to save post status:', err)
  }
}

// Update useEffect to load both:
useEffect(() => {
  loadQueue()
  loadPostStatus()
}, [])

// Update dismissPost to save status:
function dismissPost(post: UnscheduledPost) {
  setUnscheduledPosts(unscheduledPosts.map(p => 
    p.id === post.id ? { ...p, status: 'dismissed' } : p
  ))
  savePostStatus(post.id, 'dismissed')
}

// Add markAsPosted function:
function markAsPosted(post: UnscheduledPost) {
  setUnscheduledPosts(unscheduledPosts.map(p => 
    p.id === post.id ? { ...p, status: 'posted' } : p
  ))
  savePostStatus(post.id, 'posted')
}

// Update filter logic (replace lines around 130):
const activeUnscheduled = unscheduledPosts.filter(p => p.status === 'unscheduled')
const dismissedPosts = unscheduledPosts.filter(p => p.status === 'dismissed')
const postedPosts = unscheduledPosts.filter(p => p.status === 'posted')

// Apply platform filter
const displayedUnscheduled = showDismissed 
  ? (unscheduledFilter === 'all' 
      ? dismissedPosts 
      : dismissedPosts.filter(p => p.platform === unscheduledFilter))
  : (unscheduledFilter === 'all'
      ? activeUnscheduled
      : activeUnscheduled.filter(p => p.platform === unscheduledFilter))

// Add platform filter buttons in sidebar header (after line 220):
<div className="flex items-center justify-between mb-2">
  <h3 className="text-lg font-semibold text-gray-900">
    {showDismissed ? 'Dismissed' : 'Unscheduled'} ({displayedUnscheduled.length})
  </h3>
  <button
    onClick={() => setShowDismissed(!showDismissed)}
    className="text-xs px-2 py-1 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded font-medium"
  >
    {showDismissed ? `← Unscheduled (${activeUnscheduled.length})` : `Dismissed (${dismissedPosts.length})`}
  </button>
</div>

{/* Platform filter buttons */}
<div className="flex gap-1 mb-3">
  {(['all', 'twitter', 'linkedin', 'instagram'] as const).map(filter => (
    <button
      key={filter}
      onClick={() => setUnscheduledFilter(filter)}
      className={`flex-1 px-2 py-1 rounded text-xs font-medium transition-colors ${
        unscheduledFilter === filter
          ? 'bg-blue-600 text-white'
          : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
      }`}
    >
      {filter === 'all' ? 'All' : filter.charAt(0).toUpperCase()}
    </button>
  ))}
</div>

// Update button section in post card (around line 260):
<div className="flex gap-2">
  {showDismissed ? (
    <button
      onClick={(e) => {
        e.stopPropagation()
        undismissPost(post)
      }}
      className="flex-1 px-2 py-1 bg-green-100 text-green-700 rounded text-xs font-medium hover:bg-green-200"
    >
      Restore
    </button>
  ) : post.status === 'posted' ? (
    <div className="flex-1 px-2 py-1 bg-green-100 text-green-700 rounded text-xs font-medium text-center">
      ✓ Posted
    </div>
  ) : (
    <>
      <button
        onClick={(e) => {
          e.stopPropagation()
          autoSchedulePost(post)
        }}
        className="flex-1 px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs font-medium hover:bg-blue-200"
      >
        Auto-schedule
      </button>
      <button
        onClick={(e) => {
          e.stopPropagation()
          markAsPosted(post)
        }}
        className="px-2 py-1 bg-green-100 text-green-700 rounded text-xs font-medium hover:bg-green-200"
        title="Mark as Posted"
      >
        ✓
      </button>
      <button
        onClick={(e) => {
          e.stopPropagation()
          dismissPost(post)
        }}
        className="px-3 py-1 bg-gray-200 text-gray-700 rounded text-xs font-medium hover:bg-gray-300"
        title="Dismiss"
      >
        ×
      </button>
    </>
  )}
</div>
